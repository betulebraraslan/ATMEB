<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Evaluationen</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="content-wrapper">
    <div style="margin-bottom: 30px;">
        <button class="add-btn" onclick="window.location.href='uebersicht.html'">
            ‚Üê Zur √úbersicht
        </button>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
            <h1 class="main-title" id="courseHeader" style="margin: 0;">Evaluationen</h1>

            <div style="display: flex; gap: 10px;">
                <button class="add-btn" onclick="goToDashboard()">
                    üìä Kurs√ºbersicht
                </button>

                <button class="add-btn" onclick="goToNeueEvaluation()">
                    Neue Evaluation erstellen
                </button>
            </div>
        </div>
    </div>

    <div class="courses-grid" id="evalGrid">
        </div>
</div>

<script>
const selectedCourse = localStorage.getItem("selectedCourse") || "Kurs";
document.getElementById("courseHeader").innerText =
    "Evaluationen f√ºr: " + selectedCourse;

const evalGrid = document.getElementById("evalGrid");

// ===== 1. Load alle Evaluationen =====
let evaluations = JSON.parse(localStorage.getItem("evaluations")) || [];

// ===== 2. Woche 1‚Äì3 automatisch erzeugen (nur 1x) =====
for (let i = 1; i <= 3; i++) {
    const title = `${selectedCourse} ‚Äì Woche ${i}`;

    const exists = evaluations.find(ev =>
        ev.course === selectedCourse &&
        ev.title === title
    );

    if (!exists) {
        evaluations.push({
            id: Date.now() + i,
            course: selectedCourse,
            title: title,
            questions: [],
            origin: "evaluationen"
        });
    }
}

// speichern (falls neue Woche erzeugt wurde)
localStorage.setItem("evaluations", JSON.stringify(evaluations));

// ===== 3. Nur Evaluationen dieses Kurses anzeigen =====
const courseEvaluations = evaluations.filter(ev =>
    ev.course === selectedCourse &&
    ev.origin === "evaluationen"
);

// ===== 4. Render =====
evalGrid.innerHTML = "";

courseEvaluations.forEach(ev => {
    const box = document.createElement("div");
    box.className = "course-box";

    box.innerHTML = `
        <h3>${ev.title}</h3>
        <small>${ev.questions.length} Fragen</small>

        <div style="margin-top:10px; display:flex; gap:10px;">
            <button class="add-btn"
                onclick="editEvaluation(${ev.id}); event.stopPropagation();">
                ‚úèÔ∏è Bearbeiten
            </button>

            <button class="add-btn"
                onclick="deleteEvaluation(${ev.id}); event.stopPropagation();">
                üóëÔ∏è L√∂schen
            </button>
        </div>
    `;

    box.onclick = () => editEvaluation(ev.id);
    evalGrid.appendChild(box);
});

// ===== Funktionen =====
function editEvaluation(id) {
    localStorage.setItem("currentEvaluationId", id);
    localStorage.setItem("evaluationSource", "evaluationen");
    window.location.href = "evaluation_detail.html";
}

function deleteEvaluation(id) {
    if (!confirm("M√∂chten Sie diese Evaluation wirklich l√∂schen?")) return;

    let evaluations = JSON.parse(localStorage.getItem("evaluations")) || [];
    evaluations = evaluations.filter(e => e.id !== id);

    localStorage.setItem("evaluations", JSON.stringify(evaluations));
    location.reload();
}

function goToNeueEvaluation() {
    localStorage.removeItem("currentEvaluationId");
    localStorage.setItem("evaluationSource", "evaluationen");
    window.location.href = "neue_evaluation.html";
}

function goToDashboard() {
    window.location.href = "dashboard.html";
}
</script>


</body>
</html>